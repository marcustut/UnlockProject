{% extends "home/base.html" %}

{% block title %}Mission{% endblock %}

{% block content %}
    <div class="container">
      <div class="jumbotron active-mission mb-5">
        <div class="container-fluid text-center">
          <div class="container mb-5">
            <div class="row">
              <div class="col text-right">
                <button id="languageSwitcher" class="btn btn-sm btn-secondary" onclick="descChangeLang()">中文</button>
              </div>
            </div>
          </div>
            <h1 id="main-h1"><b>HAHA! It's not finished yet!</b></h1>
            <h3 id="sub-h3">There's a part 2 to this Mission</h3><br>
            <h4 id="instruction" class="mb-2"><span style="font-size: 30px"><b><u>欢迎来到这个任务的第二部分！</u></b></span></h4>
            <h4 id="remark"><br>
                请把刚刚您找到的第四（4）首歌词中的 “let the storm rage on”<br>以唱的方式翻译成以下的 8 种语言，并提交上来。<br><br>
                <span style="font-size: 17px;"><i><mark>注：1/ 若小组只有6人，其中两人需重复唱剩余的语言。</mark></i><br>
                <i><mark>2/ 成交次数只限于1次，请在上传前再三确认答案是否正确。</mark></i></span></h4>
        </div>
        {% for message in messages %}
        <div class="container w-75 mt-5">
          <div class="alert alert-danger mb-4 text-center" role="alert">
            {% autoescape off %}
            {{ message }}
            {% endautoescape %}
          </div>
        </div>
        {% endfor %}
        <div class="container text-center mb-5">
          <div class="" id="uploadAlert" role="alert">
          </div>
          <div class="row">
            <div class="col">
              <p id="AudioTitle1" style="display: none;"><b>泰语 Thai</b></p>
              <audio id="UploadedAudio1" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC1" />
              </audio>
            </div>
            <div class="col">
              <p id="AudioTitle2" style="display: none;"><b>德语 German</b></p>
              <audio id="UploadedAudio2" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC2" />
              </audio>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col">
              <p id="AudioTitle3" style="display: none;"><b>日语 Japanese</b></p>
              <audio id="UploadedAudio3" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC3" />
              </audio>
            </div>
            <div class="col">
              <p id="AudioTitle4" style="display: none;"><b>俄语 Russian</b></p>
              <audio id="UploadedAudio4" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC4" />
              </audio>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col">
              <p id="AudioTitle5" style="display: none;"><b>淡米尔文 Tamil</b></p>
              <audio id="UploadedAudio5" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC5" />
              </audio>
            </div>
            <div class="col">
              <p id="AudioTitle6" style="display: none;"><b>葡萄牙文 Portuguese</b></p>
              <audio id="UploadedAudio6" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC6" />
              </audio>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col">
              <p id="AudioTitle7" style="display: none;"><b>韩语 Korea</b></p>
              <audio id="UploadedAudio7" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC7" />
              </audio>
            </div>
            <div class="col">
              <p id="AudioTitle8" style="display: none;"><b>法文 French</b></p>
              <audio id="UploadedAudio8" style="display: none;" controls>
                <source src="" id="UploadedAudioSRC8" />
              </audio>
            </div>
          </div>
        </div>
        <div class="container-fluid text-center mt-4">
          <p class="mb-4">👇 <kbd>Upload your audio files here</kbd> 👇</p>
          <form method="POST" enctype="multipart/form-data" class="upload-form">
            {% csrf_token %}
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio1" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel1" for="customFile">泰语 Thai</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio2" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel2" for="customFile">德语 German</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio3" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel3" for="customFile">日语 Japanese</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio4" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel4" for="customFile">俄语 Russian</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio5" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel5" for="customFile">淡米尔文 Tamil</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio6" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel6" for="customFile">葡萄牙文 Portuguese</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio7" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel7" for="customFile">韩语 Korean</label>
            </div>
            <div class="custom-file col-sm-3 mb-2 mr-1">
              <input type="file" class="custom-file-input" accept="audio/*" name="translatedAudio8" id="customFile">
              <label class="custom-file-label text-left" id="audioLabel8" for="customFile">法文 French</label>
            </div>
            <div class="container">
              <input class="btn btn-primary col-sm-2 mt-3" type="submit" value="Submit"/>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Disbable back button
      history.pushState(null, null, null)
      window.addEventListener('popstate', function() {
        history.pushState(null, null, null);
      })

      // Disable Form Resubmission without RPG(Redirect/Post/Get)
      if ( window.history.replaceState ) {
        window.history.replaceState( null, null, window.location.href );
      }

      // Change Language
      function descChangeLang() {
        var mainH1 = document.querySelector("#main-h1");
        var subH3 = document.querySelector("#sub-h3");
        var instruction = document.querySelector("#instruction");
        var remark = document.querySelector("#remark");
        var languageSwitcher = document.querySelector("#languageSwitcher");

        if (instruction.innerText.includes("欢迎来到这个任务")) {
          instruction.innerHTML = '<span style="font-size: 30px"><b><u>Welcome to the second part of this mission!</u></b></span>';
          remark.innerHTML = '<br>Please sing the following song lyrics "let the storm rage on"<br> in the following eight (8) languages for submission.<br><br><span style="font-size: 15px;"><i><mark>NOTE: 1. If your group has only six (6) members, <br> please find member(s) within your groups to accomplish the remaining language(s).</mark></i><br><i><mark>2. There is only ONE (1) submission trial, please check before you submit.</mark></i></span>';
          languageSwitcher.innerHTML = 'English';
        } else {
          instruction.innerHTML = '<span style="font-size: 30px"><b><u>欢迎来到这个任务的第二部分！</u></b></span>';
          remark.innerHTML = '<br>请把刚刚您找到的第四（4）首歌词中的 “let the storm rage on”<br>以唱的方式翻译成以下的 8 种语言，并提交上来。<br><br><span style="font-size: 17px;"><i><mark>注：1/ 若小组只有6人，其中两人需重复唱剩余的语言。</mark></i><br><i><mark>2/ 成交次数只限于1次，请在上传前再三确认答案是否正确。</mark></i></span>';
          languageSwitcher.innerHTML = '中文';
        }
      }

      // Function to display audio
      function displayAudio(event, id) {
        var files = event.target.files;
        var fileName = files[0].name;
        var audioTag = document.getElementById("UploadedAudio" + id.toString());
        var audioTitle = document.getElementById("AudioTitle" + id.toString());
        var audioLabel = document.getElementById("audioLabel" + id.toString());
        var uploadAlert = document.getElementById("uploadAlert");

        // Changing the SRC of source to audio URL
        $("#UploadedAudioSRC" + id.toString()).attr("src", URL.createObjectURL(files[0]));
        audioTag.load();

        // Changing the label to fileName
        audioLabel.innerHTML = fileName;

        // Display information
        uploadAlert.classList.add('alert', 'alert-warning', 'mb-5', 'mt-5');
        uploadAlert.innerHTML = "Uploaded Audios will be displayed below.<br><i>please make sure you uploaded all <b>8 valid audios</b> before submitting.</i>";
        audioTag.setAttribute("style", "");
        audioTitle.setAttribute("style", "");
      }
      
      for (let i=1; i<=8; i++)
        document.getElementsByName("translatedAudio" + i.toString())[0].addEventListener("change", function() {
          console.log(i);
          displayAudio(event, i);
        }, false);
    </script>
{% endblock %}